@model Inventory.Models.ViewModels.Distribution_VM

@{
    var empSearch = ViewBag.emSearch as Inventory.Models.ViewModels.Employee_Search;

    ViewBag.Title = Labels.DistributionTicket;
    Layout = "~/Views/Shared/_Layout.cshtml";
    var _user = ViewBag.AppUser as Inventory.Models.ViewModels.UserWithRole;
    string model_json = Newtonsoft.Json.JsonConvert.SerializeObject(Model);
}
<form action="@Url.Action(Model.DistributionID == 0 ? "Insert" : "Update")" id="main_form" autocomplete="off">
    <input type="hidden" name="DistributionID" value="@Model.DistributionID" />
    <input type="hidden" name="EmpID" id="EmpID" value="@Model.EmpID" />
    <div class="portlet box blue-hoki margin-bottom-10">
        <div class="portlet-title">
            <div class="caption">
                Requester Information
            </div>
            <div class="actions">
                <a href="#popup_employee" data-toggle="modal" class="btn btn-xs btn-circle blue-steel"><i class="fa fa-user"></i>Select Employee</a>
            </div>
        </div>
        <div class="portlet-body">
            <section class="row">
                <div class="col-md-2 form-group">
                    <label>@Labels.Name</label>
                    <input type="text" name="EmpName" id="EmpName" readonly value="@Model.EmpName" class="form-control input-sm" required data-msg="" placeholder="">
                </div>
                <div class="col-md-3 form-group">
                    <label>@Labels.FatherName</label>
                    <input type="text" name="EmpFatherName" id="EmpFatherName" readonly value="@Model.EmpFatherName" class="form-control input-sm" required data-msg="" placeholder="">
                </div>
                <div class="col-md-3 form-group">
                    <label>@Labels.Occupation</label>
                    <input type="text" name="EmpOccupation" id="EmpOccupation" readonly value="@Model.EmpOccupation" class="form-control input-sm" required data-msg="" placeholder="">
                </div>
                <div class="col-md-4 form-group">
                    <label>Department</label>
                    <input type="text" name="EmpDepartmentName" id="EmpDepartmentName" readonly value="@Model.EmpDepartmentName" class="form-control input-sm" required data-msg="" placeholder="">
                </div>
            </section>
        </div>
    </div>
    <div class="portlet box blue-hoki margin-bottom-10">
        <div class="portlet-title">
            <div class="caption">
                @Labels.TicketAndRequestInfo
            </div>
        </div>
        <div class="portlet-body">
            <section class="row">
                <div class="col-md-3 form-group">
                    <label>@Labels.TicketNumber</label>
                    <div class="col-md-8">
                        <input type="text" name="TicketNumber" id="TicketNumber" value="@Model.TicketNumber" class="form-control input-sm" required data-msg="" placeholder="">
                    </div>
                </div>
                <div class="col-md-3 form-group">
                    <label>@Labels.TicketIssedDate</label>
                    <div class="col-md-8">
                        <input type="text" name="TicketIssuedDateVM" id="TicketIssuedDateVM" value="@Model.TicketIssuedDateForm" class="form-control input-sm shpicker_f" required data-msg="" placeholder="">
                    </div>
                </div>
                <div class="col-md-6 form-group">
                    <label>@Labels.Warehouse</label>
                    <div class="col-md-8">
                        <input type="text" name="Warehouse" id="Warehouse" value="@Model.Warehouse" class="form-control input-sm" required data-msg="" placeholder="">
                    </div>
                </div>
            </section>
            <section class="row">
                <div class="col-md-3 form-group">
                    <label>@Labels.RequestNumber</label>
                    <div class="col-md-8">
                        <input type="text" name="RequestNumber" id="RequestNumber" value="@Model.RequestNumber" class="form-control input-sm" required data-msg="" placeholder="">
                    </div>
                </div>
                <div class="col-md-3 form-group">
                    <label>@Labels.RequestDate</label>
                    <div class="col-md-8">
                        <input type="text" name="RequestDateVM" id="RequestDateVM" value="@Model.RequestDateForm" class="form-control input-sm shpicker_f" required data-msg="" placeholder="">
                    </div>
                </div>
                <div class="col-md-6 form-group">
                    <label>@Labels.Attachment</label>
                    <div class="col-md-8">
                        <input type="file" id="FileContent" name="FileContent" @(Model.DistributionID == 0 ? "required" : "") accept="image/*,.pdf" />
                    </div>
                </div>
                @*<div class=" col-md-6 form-group">
            <label>@Labels.Requester</label>
            <div class="col-md-8">
                @Html.DropDownList("DistributionID", ViewBag.DepartmentDrp as SelectList, Labels.please_select, new { @class = "form-control input-sm", @ID = "DistributionID", @Required = "required" })
            </div>
        </div>*@
            </section>
        </div>
    </div>

    <div class="portlet box blue-hoki margin-bottom-10">
        <div class="portlet-title">
            <div class="caption">@Labels.TicketItems</div>
            <div class="actions">
                <a href="javascript:;" class="btn btn-xs btn-circle blue-steel" id="btn_add_item">
                    <i class="fa fa-plus"></i> @Labels.AddItem
                </a>
            </div>
        </div>
        <div class="portlet-body">
            <table class="table table-striped table-condensed">
                <thead id="thead_attendee">
                    <tr>
                        <th>@Labels.Quantity</th>
                        <th>@Labels.Unit</th>
                        <th>@Labels.ItemDetails</th>
                        <th>@Labels.UnitPrice</th>
                        <th>@Labels.TotalPrice</th>
                        <th>@Labels.DealWithAccount</th>
                        <th></th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="tbody_item">
                    @{
                        int index = 0;
                        if (Model.DistributionItems != null)
                        {
                            foreach (var item in Model.DistributionItems)
                            {
                                <tr>
                                    <td>@item.Quantity</td>
                                    <td>@item.UnitName</td>
                                    <td>@item.ProductName</td>
                                    <td>@item.UnitPrice</td>
                                    <td>@item.TotalPrice</td>
                                    <td>@item.DealWithAccount</td>
                                    <td>
                                        <a href="javascript:;" class="btn btn-xs btn-info item_edit" data-index="@index"><i class="fa fa-edit"></i></a>
                                        <a href="javascript:;" class="btn btn-xs btn-danger item_delete" data-index="@index" data-title="@Labels.are_you_sure" data-btn-ok-label="@Labels.yes" data-btn-cancel-label="@Labels.no"><i class="fa fa-trash"></i></a>
                                    </td>
                                </tr>
                                index++;
                            }
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12 form-group">
            <label>@Labels.Details</label>
            <div class="col-md-10">
                <textarea type="text" name="Details" id="Details" class="form-control" required data-msg="" placeholder="">@Model.Details</textarea>
            </div>
        </div>
    </div>

    <section class="row">
        <div class="col-md-5">
            <button type="submit" class="btn btn-sm blue" id="btn_submit">@Labels.save</button>
            <button type="submit" id="btnReset" class="btn btn-sm">@Labels.reset</button>
        </div>
    </section>

</form>

<form id="item_form" method="post" action="" autocomplete="off">
    <div class="modal fade" id="item_modal" tabindex="-1" data-backdrop="static">
        <div class="modal-dialog" style="width:60%;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                    <h4 class="modal-title">@Labels.AddItem</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12 form-group">
                            <label>Product Code</label>
                            <div class="col-md-10">
                                <input type="number" name="ProductCodeInput" id="ProductCodeInput" class="form-control input-sm ProductCodeSearchable" data-rule-digits="true" data-msg="" />
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 form-group">
                            <label>Usage Type</label>
                            <div class="col-md-9">
                                @Html.DropDownList("UsageTypeID", ViewBag.UsageTypeDrp as SelectList, Labels.please_select, new { @class = "form-control input-sm", @onclick = "loadProducts()", id = "UsageTypeID", @required = "required" })
                            </div>
                        </div>
                        <div class="col-md-6 form-group">
                            <label>Item Name</label>
                            <div class="col-md-9">
                                <select id="ProductCode" name="ProductCode" required class="form-control input-sm select2-single select2-hidden-accessible"></select>
                            </div>
                        </div>
                    </div>
              
                    <div class="row">
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>Unit Name</label>
                                <input type="text" id="UnitName" name="UnitName" class="form-control input-sm" readonly="readonly" data-msg="" />
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>Product Size</label>
                                <input type="text" id="ProductSize" name="ProductSize" class="form-control input-sm" readonly="readonly" data-msg="" />
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>Product Category</label>
                                <input type="text" id="ProductCategory" name="ProductCategory" class="form-control input-sm" readonly="readonly" data-msg="" />
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>Product Group</label>
                                <input type="text" id="ProductGroup" name="ProductGroup" class="form-control input-sm" readonly="readonly" data-msg="" />
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>Product Origin</label>
                                <input type="text" id="ProductOrigin" name="ProductOrigin" class="form-control input-sm" readonly="readonly" data-msg="" />
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 form-group">
                            <label>@Labels.Quantity</label>
                            <div class="col-md-9">
                                <input type="number" name="Quantity" class="form-control input-sm" required data-msg="" />
                            </div>
                        </div>
                        <div class="col-md-6 form-group">
                            <label>@Labels.UnitPrice</label>
                            <div class="col-md-9">
                                <input type="number" name="UnitPrice" class="form-control input-sm" data-rule-digits="true" data-msg="" />
                            </div>
                        </div>
                        <div class="col-md-6 form-group">
                            <label>@Labels.DealWithAccount</label>
                            <div class="col-md-9">
                                <input type="text" name="DealWithAccount" class="form-control input-sm" data-msg="" />
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn green btn-sm">@Labels.save</button>
                    <button type="button" class="btn default btn-sm" data-dismiss="modal">@Labels.cancel</button>
                    <button type="reset" id="btnResetModal" class="btn btn-sm">@Labels.reset</button>
                    <input type="hidden" id="index" name="index" value="-1">
                    <input type="hidden" name="ID" value="0">
                </div>
            </div>
        </div>
    </div>
</form>

<div class="modal fade" id="popup_employee" data-keyboard="false" data-backdrop="static">
    <div class="modal-dialog" style="width:800px;">
        <div class="modal-content">
            <div class="modal-header blue">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                Employee
            </div>
            <div class="portlet-body">
                <form id="employee_search_form" autocomplete="off" class="margin-top-10">
                    <section class="row">
                        <div class="col-md-6 form-group">
                            <label>@Labels.Name</label>
                            <div class="col-md-8">
                                <input type="text" class="form-control input-sm" name="sName" value="@empSearch.sName" placeholder="@Labels.Name" id="sName" />
                            </div>
                        </div>
                        <div class="col-md-6 form-group">
                            <label>@Labels.FatherName</label>
                            <div class="col-md-8">
                                <input type="text" class="form-control input-sm" name="sFatherName" value="@empSearch.sFatherName" placeholder="@Labels.FatherName" id="sFatherName" />
                            </div>
                        </div>
                    </section>
                    <section class="row">
                        <div class="col-md-6 form-group">
                            <label>@Labels.Occupation</label>
                            <div class="col-md-8">
                                <input type="text" name="sOccupation" id="sOccupation" value="@empSearch.sOccupation" class="form-control input-sm" data-msg="" placeholder="@Labels.Occupation">
                            </div>
                        </div>
                        <div class="col-md-6 form-group">
                            <label>Department</label>
                            <div class="col-md-8">
                                @Html.DropDownList("sDepartmentID", ViewBag.DepartmentDrp as SelectList, "Select Department", new { @class = "form-control" })
                            </div>
                        </div>
                    </section>
                    <section class="row">
                        <div class="col-md-12 form-group" style="margin-left:10px; margin-right:10px;">
                            <button type="submit" class="btn btn-sm blue "><i class="fa fa-search"></i> @Labels.search</button>
                            <button type="reset" id="btnReset" class="btn btn-sm ">@Labels.reset</button>
                        </div>
                    </section>
                </form>

                <section class="row">
                    <div class="col-md-12" id="list_div" style="overflow:auto">
                        <table class="table table-striped table-hover table-condensed" id="employee_table">
                            <thead>
                                <tr>
                                    <th>@Labels.Name</th>
                                    <th>@Labels.FatherName</th>
                                    <th>@Labels.Occupation</th>
                                    <th>Department</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </section>
            </div>
        </div>
    </div>
</div>


@section scripts{
    <script type="text/html" id="temp_item">
        <tr>
            <td>{{Quantity}}</td>
            <td>{{UnitName}}</td>
            <td>{{ProductName}}</td>
            <td>{{UnitPrice}}</td>
            <td>{{TotalPrice}}</td>
            <td>{{DealWithAccount}}</td>
            <td>
                <a href="javascript:;" class="btn btn-xs btn-info item_edit" data-index="{{index}}"><i class="fa fa-edit"></i></a>
                <a href="javascript:;" class="btn btn-xs btn-danger item_delete" data-index="{{index}}" data-title="@Labels.are_you_sure" data-btn-ok-label="@Labels.yes" data-btn-cancel-label="@Labels.no"><i class="fa fa-trash"></i></a>
            </td>
        </tr>
    </script>
    <script>
        var model = @Html.Raw(Json.Encode(Model));
        $(function () {
            var DistributionItems = [];
            var DistributionID = '@Model.DistributionID';
            if (DistributionID != '0') {
                //var model = JSON.parse($("#model_json").val());
                DistributionItems = model.DistributionItems;
            }

            $('#ProductCode').change(function () {
                var productCode = $(this).val();
                $.ajax({
                    type: "post",
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    url: '@Url.Action("LoadProductInfo", "Helper")', // URL to fetch second ddl
                    data: "{productCode:'" + productCode + "'}",
                    success: function (data) {
                        $("#ProductSize").val(data.ProductSize);
                        $("#ProductCategory").val(data.ProductCategory);
                        $("#ProductGroup").val(data.ProductGroup);
                        $("#ProductOrigin").val(data.ProductOrigin);
                        $("#UnitName").val(data.UnitName);
                    },
                    failure: function (data) {
                        alert('error occured');
                    }
                });
            });

            // FORM VALIDATION AND SUBMISSION
            $('#main_form').validate({
                submitHandler: function (form) {
                    console.log("Inside the main_form the >>>>>>>");
                    var data = $('#main_form').serializeJSON({
                        parseAll: true,
                        useIntKeysAsArrayIndex: true,
                    });
                    data['DistributionItems'] = DistributionItems.filter(function (obj) { return obj != null; });
                    if (data['DistributionItems'].length == 0) {
                        toastr.error('Please Add Item');
                        return;
                    }
                    console.log("data is >>>>>>>?????????"+JSON.stringify(data));
                    var formData = ObjectToFormData(data);
                    console.log("items are >>>>>>>>>>><<<<<<<<<<<"+ JSON.stringify(formData));
                    //******************
                    Metronic.blockUI({ animate: true });
                    $.ajax({
                        url: $('#main_form').attr('action'),
                        type: 'POST',
                        data: formData,
                        processData: false,
                        contentType: false,
                        success: function (response) {
                            if (response != false) {
                                saveImage(response);
                                console.log("response received >>>>>>>>>><<<<<<");
                            } else {
                                toastr.error('@Labels.unable_to_update');
                            }
                        },
                        complete: function () {
                            Metronic.unblockUI();
                        }
                    })
                }
            })
            // Employee search FORM VALIDATION AND SUBMISSION
            $('#employee_form').validate({
                submitHandler: function (form) {
                    var data = $('#main_form').serializeJSON({
                        parseAll: true,
                        useIntKeysAsArrayIndex: true,
                    });
                    var formData = ObjectToFormData(data);
                    //******************
                    Metronic.blockUI({ animate: true });
                    $.ajax({
                        url: $('#employee_form').attr('action'),
                        type: 'POST',
                        data: formData,
                        processData: false,
                        contentType: false,
                        success: function (response) {
                            if (response != false) {
                                bootbox.alert('@Labels.operation_done_suc', function () {
                                    window.location.href = '@Url.Action("View")/' + response;
                                })
                            } else {
                                toastr.error('@Labels.unable_to_update');
                            }
                        },
                        complete: function () {
                            Metronic.unblockUI();
                        }
                    })
                }
            })

            $('body').on('click', '#btn_add_item', function (e) {
                e.preventDefault();
                $('#item_modal').modal('show');
                $('#item_form').clearForm();
                $('#item_form [name=ItemID]').val('0');
                $('#item_form [name=index]').val('-1');
            })

            $('body').on('click', '.item_edit', function (e) {
                e.preventDefault();
                $('#item_modal').modal('show');
                var index = $(this).data().index;
                var row = DistributionItems[index];
                console.log("row is >>>>>>>"+JSON.stringify(row));
                $('#item_form [name=Quantity]').val(row.Quantity);
                $('#item_form [name=UnitID]').val(row.UnitID);
                $('#item_form [name=ItemDetails]').val(row.ItemDetails);
                $('#item_form [name=UnitPrice]').val(row.UnitPrice);
                $('#item_form [name=DealWithAccount]').val(row.DealWithAccount);
                $('#item_form [name=ItemID]').val(row.ItemID);
                $('#item_form [name=index]').val(index);
            })

            $('#item_form').validate({
                submitHandler: function (form) {
                    var isDuplicate = false;
                    DistributionItems.forEach(function(i){
                        if(i.ProductCode == $('#ProductCode').val()){
                            isDuplicate = true;
                            return;
                        }
                    })
                    if(isDuplicate && $('#index').val() === "-1"){
                        toastr.error("Duplicate Product");
                        return;
                    }
                    var row = $(form).serializeJSON();
                    var _index = (row.index == -1) ? DistributionItems.length : row.index;
                    var tr = $('#temp_item').clone().html()
                    .replace("{{Quantity}}", row.Quantity)
                    .replace("{{UnitName}}", row.UnitName)
                    .replace("{{ProductName}}", $('#item_form [name=ProductCode] option:selected').text())
                    .replace("{{UnitPrice}}", row.UnitPrice)
                    .replace("{{TotalPrice}}", row.Quantity * row.UnitPrice)
                    .replace("{{DealWithAccount}}", row.DealWithAccount)
                    .replace("{{index}}", _index);
                    if (row.index == -1) {
                        $('#tbody_item').append(tr);
                        $('#item_form').clearForm();
                        $('#item_form input:first').focus();
                        DistributionItems.push(row);
                    } else {
                        $('#tbody_item').find('[data-index=' + row.index + ']').closest('tr').replaceWith(tr);
                        $('#item_modal').modal('hide');
                        console.log("row in item form valided +++++++"+JSON.stringify(row));
                        DistributionItems[row.index] = row;
                    }
                    console.log("items are >>>>>>>>>>>>>"+JSON.stringify(DistributionItems));
                    $('#ProductCode').empty();
                    $('#ProductCode').append('<option selected="selected" value="">'+"Product Name"+'</option>');
                    $("#select2-ProductCode-container").prop("title", "Product Name").text("Product Name");
                    console.log("TicketItems are +++++++++"+JSON.stringify(DistributionItems));

                }
            })

            $('body').on('click', '.item_delete', function (e) {
                e.preventDefault()
                $(this).confirmation('show');
            })

            $('body').on('confirmed.bs.confirmation', '.item_delete', function (e) {
                var index = $(this).data().index;
                DistributionItems[index] = null;
                $(this).closest('tr').remove();
            })

            $('#ProductCode').select2({
                dropdownParent: $('#item_modal'),
                theme: "bootstrap",
                placeholder: "Select a product code",
                width: null,
                containerCssClass: ':all:'
                });

            $('#employee_search_form').submit(function (e, param) {
                console.log(">>>>>>>>>>>>>>>>>>><<<<<<< Insdie the call funtion");
                e.preventDefault();
                Metronic.blockUI({
                    target: '#list_div',
                    animate: true
                });
                var data = $('#employee_search_form').serializeJSON();
                var json = JSON.stringify(data);
                var url = '@Url.Action("EmployeeList")';
                $.ajax({
                    url: url,
                    type: 'POST',
                    data: json,
                    contentType: 'application/json',
                    success: function (response) {
                        console.log(JSON.stringify(response));
                        $('#employee_table > tbody').empty();
                        response.forEach(function(emp){
                            var selectBtn = '<button class="btn btn-xs btn-primary btn_select_employee" data-id="' + emp.EmployeeID + '">Select</button>';
                            $('#employee_table > tbody').append('<tr><td>'+emp.Name+'</td><td>'+emp.FatherName+'</td><td>'+emp.Occupation+'</td><td>'+emp.DepartmentName+'</td><td>'+selectBtn+'</td></tr>');
                        })
                        Metronic.unblockUI('#list_div');
                    }
                })
            })

            $('body').on('click', '.btn_select_employee', function (e) {
                e.preventDefault();
                //popup_employee
                var tr = $(this).closest('tr');
                var EmployeeID = $(this).data().id;
                console.log(EmployeeID);
                var Name = $(tr).find('td:first').text();
                var FatherName = $(tr).find('td:nth-child(2)').text();
                var Occpation = $(tr).find('td:nth-child(3)').text();
                var Department = $(tr).find('td:nth-child(4)').text();
                $('#EmpID').val(EmployeeID);
                $('#EmpName').val(Name);
                $('#EmpFatherName').val(FatherName);
                $('#EmpOccupation').val(Occpation);
                $('#EmpDepartmentName').val(Department);
                $('#popup_employee').modal('hide');
               // $('#employee_search_form').reset();
                $("#employee_search_form").trigger("reset");

                console.log("id is >>>>>>>>>>"+Name);
                console.log("id is >>>>>>>>>>"+FatherName);
                console.log("id is >>>>>>>>>>"+Occpation);
                console.log("id is >>>>>>>>>>"+Department);

            })
    })

    </script>
    <script>
        function saveImage(recordId){
            console.log("Inside the save image >>>>>"+recordId);
            //setTimeout(function(){
            //    console.log("Inside the timeout ");
            //},6000)

                if($("#FileContent").val()){
                    var file = $("#FileContent")[0].files[0];
                        var imageData = new FormData();
                        imageData.append('RecordID', recordId);
                        imageData.append('FileContent', file);
                        $.ajax({
                            url: 'SaveScanImage',
                            type: 'POST',
                            data: imageData,
                            contentType: false,
                            processData: false,
                            success: function(response){
                                if(response != false){
                                    bootbox.alert('@Labels.operation_done_suc', function () {
                                        window.location.href = '@Url.Action("View")/' + recordId;

                                    })
                                }
                                else{
                                    toastr.error('Unable to upload image');
                                    window.location.href = '@Url.Action("View")/' + recordId;
                                }
                            },
                            complete: function () {
                                console.log("Inside the complete ");
                                Metronic.unblockUI();
                            }
                        });
                }else{
                    Metronic.unblockUI();
                    bootbox.alert('@Labels.operation_done_suc', function () {
                        window.location.href = '@Url.Action("View")/' + recordId;
                    })
                    console.log("file content do not have value");
                }
            }
        function loadProducts(itemID) {
            var usageTypeID = $('#UsageTypeID').val()
            if (usageTypeID) {
                $.ajax({
                    type: "post",
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    url: '@Url.Action("ProductsByUsageType", "Helper")', // URL to fetch second ddl
                    data: "{usageTypeID:'" + usageTypeID + "'}",
                    success: function (data) {
                        $('#ProductCode').empty();
                        $('#ProductCode').append('<option selected="selected" value="">'+"Product Name"+'</option>');
                        $.each(data, function (i, d) {
                            $('#ProductCode').append('<option value=' + d.Value + '>' + d.Text + '</option>');
                            if(data.length == i+1 && itemID){
                                $('#ProductCode').val(itemID);
                            }
                        });
                    },
                    failure: function (data) {
                        alert('error occured');
                    },
                    complete: function(data) {

                    }
                });
            }

        }
    </script>

}
